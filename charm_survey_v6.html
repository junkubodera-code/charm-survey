<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CharmSurvey - çµ„ç¹”ã‚µãƒ¼ãƒ™ã‚¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      color: #333;
    }

    .admin-container {
      display: flex;
      height: 100vh;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 280px;
      background-color: #1F4788;
      color: white;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }

    .logo {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 30px;
      text-align: center;
      border-bottom: 2px solid #2E75B6;
      padding-bottom: 15px;
    }

    .sidebar-section {
      margin-bottom: 25px;
    }

    .sidebar-title {
      font-size: 11px;
      font-weight: bold;
      text-transform: uppercase;
      color: #CADCFC;
      margin-bottom: 10px;
      letter-spacing: 0.5px;
    }

    .sidebar-button {
      display: block;
      width: 100%;
      padding: 10px 15px;
      margin-bottom: 8px;
      background-color: #2E75B6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
      font-size: 13px;
      transition: all 0.2s;
    }

    .sidebar-button:hover {
      background-color: #3F8FCC;
      transform: translateX(4px);
    }

    .sidebar-button.active {
      background-color: #F96167;
      font-weight: bold;
    }

    .company-item {
      padding: 10px 15px;
      background-color: #2E75B6;
      color: white;
      border-radius: 4px;
      margin-bottom: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .company-item:hover {
      background-color: #3F8FCC;
      transform: translateX(4px);
    }

    .company-item.active {
      background-color: #F96167;
      font-weight: bold;
    }

    /* NEW COMPANY FORM */
    #add-company-form {
      display: none;
      background-color: #2E75B6;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 15px;
    }

    #add-company-form.visible {
      display: block;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
    }

    .form-group button {
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      background-color: #10B981;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .form-group button:last-child {
      background-color: #ef4444;
    }

    /* SETTINGS SECTION */
    .settings-section {
      background-color: #2E75B6;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 15px;
    }

    .settings-label {
      font-size: 12px;
      color: #CADCFC;
      margin-bottom: 8px;
      display: block;
    }

    .settings-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 11px;
      margin-bottom: 8px;
    }

    .settings-status {
      font-size: 11px;
      color: #10B981;
      padding: 8px;
      background-color: rgba(16, 185, 129, 0.1);
      border-radius: 4px;
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .header {
      background-color: white;
      padding: 20px 30px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .header-title {
      font-size: 24px;
      font-weight: bold;
      color: #1F4788;
    }

    .header-info {
      font-size: 13px;
      color: #64748B;
    }

    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      background-color: #f9f9f9;
    }

    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
    }

    .dashboard-title {
      font-size: 28px;
      font-weight: bold;
      color: #1F4788;
      margin-bottom: 10px;
    }

    .dashboard-subtitle {
      color: #64748B;
      margin-bottom: 30px;
      font-size: 14px;
    }

    /* ===== TABS ===== */
    .tab-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .tab-buttons {
      display: flex;
      border-bottom: 2px solid #f0f0f0;
      background-color: #f9f9f9;
    }

    .tab-button {
      padding: 15px 25px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      color: #64748B;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab-button:hover {
      color: #2E75B6;
    }

    .tab-button.active {
      color: #1F4788;
      border-bottom-color: #2E75B6;
    }

    .tab-content {
      display: none;
      padding: 30px;
    }

    .tab-content.active {
      display: block;
    }

    /* ===== RESPONDER LINK SECTION ===== */
    .responder-link-section {
      background-color: #f0f7ff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 3px solid #2E75B6;
    }

    .responder-link-title {
      font-size: 14px;
      font-weight: bold;
      color: #2E75B6;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .responder-link-description {
      font-size: 13px;
      color: #64748B;
      margin-bottom: 15px;
    }

    .link-box {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .link-input {
      flex: 1;
      min-width: 200px;
      padding: 10px;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 12px;
      font-family: monospace;
      background-color: white;
    }

    .btn {
      padding: 10px 15px;
      background-color: #2E75B6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      transition: background-color 0.2s;
      white-space: nowrap;
    }

    .btn:hover {
      background-color: #1F4788;
    }

    .btn.copied {
      background-color: #10B981;
    }

    .btn-preview {
      padding: 10px 15px;
      background-color: #F96167;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      transition: background-color 0.2s;
      white-space: nowrap;
    }

    .btn-preview:hover {
      background-color: #E85560;
    }

    /* QR CODE */
    #qr-code {
      margin-top: 15px;
      padding: 10px;
      background-color: white;
      border-radius: 4px;
      display: inline-block;
    }

    /* ===== TABLE ===== */
    .responder-table {
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    thead {
      background-color: #1F4788;
      color: white;
    }

    th {
      padding: 15px;
      text-align: left;
      font-size: 13px;
      font-weight: bold;
      text-transform: uppercase;
      border: none;
    }

    tbody tr {
      border-bottom: 1px solid #f0f0f0;
    }

    tbody tr:hover {
      background-color: #f9f9f9;
    }

    .responder-name-cell {
      cursor: pointer;
      color: #2E75B6;
      font-weight: bold;
    }

    .responder-name-cell:hover {
      text-decoration: underline;
    }

    td {
      padding: 15px;
      font-size: 13px;
    }

    .responder-details-row {
      display: none;
    }

    .responder-details-row.expanded {
      display: table-row;
    }

    .responder-details-content {
      padding: 20px;
      background-color: #f9f9f9;
    }

    .answer-section {
      margin-bottom: 20px;
      padding: 15px;
      background-color: white;
      border-radius: 4px;
      border-left: 3px solid #2E75B6;
    }

    .question-label {
      font-size: 12px;
      font-weight: bold;
      color: #2E75B6;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .question-text {
      font-size: 13px;
      font-weight: bold;
      color: #1F4788;
      margin-bottom: 10px;
    }

    .answer-text {
      background-color: #f0f7ff;
      padding: 10px;
      border-radius: 4px;
      font-size: 12px;
      color: #333;
      margin-bottom: 8px;
      font-style: italic;
    }

    .answer-rating {
      display: inline-block;
      background-color: #f0f7ff;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: #2E75B6;
      font-weight: bold;
    }

    /* ===== QUESTIONS SECTION ===== */
    .questions-table {
      margin-top: 20px;
    }

    .edit-button {
      padding: 6px 12px;
      background-color: #2E75B6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: background-color 0.2s;
    }

    .edit-button:hover {
      background-color: #1F4788;
    }

    .edit-mode {
      background-color: #fffacd !important;
    }

    .question-text-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #2E75B6;
      border-radius: 4px;
      font-size: 13px;
      font-family: Arial, sans-serif;
      resize: vertical;
      min-height: 60px;
      margin-bottom: 15px;
    }

    .options-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    .options-table th {
      background-color: #f0f0f0;
      padding: 10px;
      text-align: left;
      font-size: 12px;
    }

    .options-table td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 12px;
    }

    .options-table input {
      width: 100%;
      padding: 6px;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 12px;
    }

    .edit-controls {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .btn-save {
      padding: 8px 16px;
      background-color: #10B981;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
    }

    .btn-save:hover {
      background-color: #059669;
    }

    .btn-cancel {
      padding: 8px 16px;
      background-color: #ef4444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
    }

    .btn-cancel:hover {
      background-color: #dc2626;
    }

    /* ===== REPORT SECTION ===== */
    .report-editor {
      background-color: #f0f7ff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 3px solid #2E75B6;
    }

    .report-editor-title {
      font-size: 14px;
      font-weight: bold;
      color: #2E75B6;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .report-textarea {
      width: 100%;
      padding: 15px;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 13px;
      font-family: Arial, sans-serif;
      resize: vertical;
      min-height: 120px;
    }

    .report-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .btn-generate {
      padding: 12px 24px;
      background-color: #2E75B6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      transition: background-color 0.2s;
    }

    .btn-generate:hover {
      background-color: #1F4788;
    }

    /* SLIDE CONTAINER */
    .slide-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
      overflow: hidden;
    }

    .slide-wrapper {
      position: relative;
      width: 100%;
      padding-bottom: 62.5%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
    }

    .slide-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 40px;
      background: linear-gradient(135deg, #1F4788, #2E75B6);
      color: white;
      font-size: 14px;
      line-height: 1.6;
      overflow-y: auto;
      display: none;
    }

    .slide-content.active {
      display: block;
    }

    .slide-header {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
      padding-bottom: 10px;
    }

    .slide-body {
      font-size: 14px;
      line-height: 1.8;
    }

    .slide-body table {
      width: 100%;
      background-color: rgba(0, 0, 0, 0.1);
      border-collapse: collapse;
      margin: 15px 0;
    }

    .slide-body th, .slide-body td {
      padding: 10px;
      text-align: left;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .slide-body th {
      background-color: rgba(0, 0, 0, 0.2);
    }

    .slide-footer {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 40px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
    }

    .slide-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      justify-content: center;
    }

    .slide-btn {
      padding: 10px 20px;
      background-color: #2E75B6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
    }

    .slide-btn:hover {
      background-color: #1F4788;
    }

    .slide-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .slide-counter {
      text-align: center;
      color: #64748B;
      font-size: 12px;
      margin-top: 10px;
    }

    /* ===== SURVEY SCREEN ===== */
    .survey-container {
      max-width: 600px;
      margin: 0 auto;
      background-color: white;
      padding: 40px;
      border-radius: 8px;
    }

    .survey-header {
      margin-bottom: 40px;
      text-align: center;
    }

    .survey-title {
      font-size: 24px;
      font-weight: bold;
      color: #1F4788;
      margin-bottom: 10px;
    }

    .survey-progress {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 12px;
      color: #64748B;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background-color: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background-color: #2E75B6;
      transition: width 0.3s;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-label {
      font-size: 16px;
      font-weight: bold;
      color: #1F4788;
      margin-bottom: 15px;
      display: block;
    }

    .form-sublabel {
      font-size: 13px;
      color: #64748B;
      margin-bottom: 8px;
      display: block;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #d0d0d0;
      border-radius: 4px;
      font-size: 14px;
      font-family: Arial, sans-serif;
      margin-bottom: 10px;
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #2E75B6;
      box-shadow: 0 0 0 2px rgba(46, 117, 182, 0.1);
    }

    .rating-group {
      margin: 15px 0;
    }

    .rating-label {
      font-size: 13px;
      color: #64748B;
      margin-bottom: 10px;
      display: block;
    }

    .rating-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .rating-option {
      flex: 1;
      min-width: 80px;
      padding: 10px;
      text-align: center;
      border: 2px solid #d0d0d0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }

    .rating-option:hover {
      border-color: #2E75B6;
      background-color: #f0f7ff;
    }

    .rating-option.selected {
      border-color: #2E75B6;
      background-color: #2E75B6;
      color: white;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 30px;
      justify-content: space-between;
    }

    .btn-primary {
      background-color: #2E75B6;
      color: white;
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-primary:hover {
      background-color: #1F4788;
    }

    .btn-secondary {
      background-color: #f0f0f0;
      color: #1F4788;
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
    }

    .hidden {
      display: none !important;
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal.visible {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 20px;
      font-weight: bold;
      color: #1F4788;
      margin-bottom: 20px;
    }

    .modal-body {
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-buttons button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .modal-close-btn {
      background-color: #ef4444;
      color: white;
    }

    .modal-close-btn:hover {
      background-color: #dc2626;
    }

    .modal-copy-btn {
      background-color: #2E75B6;
      color: white;
    }

    .modal-copy-btn:hover {
      background-color: #1F4788;
    }

    .chart-container-slide {
      width: 100%;
      height: 200px;
    }
  </style>
</head>
<body>
  <!-- ADMIN MODE -->
  <div id="admin-mode" class="admin-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="logo">ğŸ¯ CharmSurvey</div>

      <div class="sidebar-section">
        <div class="sidebar-title">âš™ï¸ è¨­å®š</div>
        <div class="settings-section">
          <label class="settings-label">æœ¬ç•ªç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³å</label>
          <input type="text" id="domain-input" class="settings-input" placeholder="https://example.com" />
          <button class="sidebar-button" onclick="saveDomainSetting()" style="background-color: #10B981; margin-bottom: 0; padding: 8px 12px; font-size: 12px;">ä¿å­˜</button>
          <div id="domain-status" class="settings-status" style="display: none; margin-top: 8px;"></div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ä¼æ¥­ç®¡ç†</div>
        <button class="sidebar-button" onclick="toggleAddCompanyForm()" style="background-color: #10B981;">+ æ–°è¦ä¼æ¥­è¿½åŠ </button>

        <div id="add-company-form">
          <div class="form-group">
            <input type="text" id="company-name-input" placeholder="ä¼æ¥­åã‚’å…¥åŠ›" />
          </div>
          <div class="form-group">
            <button onclick="confirmAddCompany()">è¿½åŠ </button>
            <button onclick="cancelAddCompany()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          </div>
        </div>

        <div id="company-list" style="margin-top: 15px;">
          <!-- ä¼æ¥­ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <div class="header">
        <div>
          <div class="header-title" id="current-company-name">ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
          <div class="header-info">ä¹…ä¿å¯ºéš¼ | j.kubodera@blue-sapiens.com</div>
        </div>
      </div>

      <div class="content-area">
        <div class="dashboard" id="dashboard">
          <h2 class="dashboard-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
          <p class="dashboard-subtitle" id="dashboard-subtitle">ä¼æ¥­ã‚’é¸æŠã—ã¦ãã ã•ã„</p>

          <!-- TAB CONTAINER -->
          <div class="tab-container">
            <div class="tab-buttons">
              <button class="tab-button active" onclick="switchTab('responders-tab')">å›ç­”è€…ç®¡ç†</button>
              <button class="tab-button" onclick="switchTab('questions-tab')">è³ªå•ç®¡ç†</button>
              <button class="tab-button" onclick="switchTab('report-tab')">ãƒ¬ãƒãƒ¼ãƒˆ</button>
            </div>

            <!-- TAB 1: RESPONDERS -->
            <div id="responders-tab" class="tab-content active">
              <div class="responder-link-section">
                <div class="responder-link-title">ğŸ“‹ å›ç­”è€…ç”¨ãƒªãƒ³ã‚¯</div>
                <div class="responder-link-description">
                  ã“ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä»˜ã—ã¦ãã ã•ã„ã€‚å¾“æ¥­å“¡ãŒã“ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚µãƒ¼ãƒ™ã‚¤ã«å›ç­”ã§ãã¾ã™ã€‚
                </div>
                <div class="link-box">
                  <input type="text" class="link-input" id="survey-link" value="" readonly>
                  <button class="btn" onclick="copySurveyLink()">ã‚³ãƒ”ãƒ¼</button>
                  <button class="btn-preview" onclick="openSurveyPreview()">ğŸ“‹ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                </div>
                <div id="qr-code"></div>
              </div>

              <div class="responder-table">
                <h3 style="color: #1F4788; margin-bottom: 15px;">å›ç­”è€…ä¸€è¦§</h3>
                <table id="responder-table">
                  <thead>
                    <tr>
                      <th>å›ç­”è€…å</th>
                      <th>éƒ¨ç½²</th>
                      <th>å½¹è·</th>
                      <th>å…¥ç¤¾æ—¥</th>
                      <th>å›ç­”çŠ¶æ³</th>
                    </tr>
                  </thead>
                  <tbody id="responder-tbody">
                    <!-- å›ç­”è€…ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- TAB 2: QUESTIONS -->
            <div id="questions-tab" class="tab-content">
              <h3 style="color: #1F4788; margin-bottom: 15px;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å•ï¼ˆQ1ï½Q5ï¼‰</h3>
              <div class="questions-table">
                <table id="questions-table">
                  <thead>
                    <tr>
                      <th>è¨­å•</th>
                      <th style="width: 100px;">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="questions-tbody">
                    <!-- è³ªå•ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- TAB 3: REPORT -->
            <div id="report-tab" class="tab-content">
              <div class="report-editor">
                <div class="report-editor-title">ğŸ“ ç·¨é›†ã‚¨ãƒªã‚¢</div>
                <p style="font-size: 12px; color: #64748B; margin-bottom: 15px;">
                  å¾Œã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚„è§£é‡ˆã‚’è¿½è¨˜ã—ãŸã„å†…å®¹ã‚’ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                </p>
                <textarea class="report-textarea" id="report-custom-text" placeholder="CEOå‘ã‘ã®è£œè¶³ã‚³ãƒ¡ãƒ³ãƒˆã€è¿½åŠ ã®æŒ‡æ‘˜ãªã©..."></textarea>

                <div class="report-buttons">
                  <button class="btn-generate" onclick="generatePDF()">ğŸ“¥ PDF ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                  <button class="btn-generate" onclick="generateGoogleSlides()">ğŸ¯ Google ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆ</button>
                  <button class="btn-generate" onclick="showPrompt()">ğŸ’¡ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º</button>
                </div>
              </div>

              <!-- SLIDE REPORT -->
              <div class="slide-container">
                <div class="slide-wrapper">
                  <div id="slide-1" class="slide-content active">
                    <div class="slide-header">ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼</div>
                    <div class="slide-body" id="slide-1-body"></div>
                  </div>
                  <div id="slide-2" class="slide-content">
                    <div class="slide-header">â‘¡ è³ªå•åˆ¥è©³ç´°åˆ†æ</div>
                    <div class="slide-body" id="slide-2-body"></div>
                  </div>
                  <div id="slide-3" class="slide-content">
                    <div class="slide-header">â‘¢ éƒ¨ç½²åˆ¥æ¯”è¼ƒåˆ†æ</div>
                    <div class="slide-body" id="slide-3-body"></div>
                  </div>
                  <div id="slide-4" class="slide-content">
                    <div class="slide-header">â‘£ AIåˆ†æã‚³ãƒ¡ãƒ³ãƒˆ</div>
                    <div class="slide-body" id="slide-4-body"></div>
                  </div>
                  <div id="slide-5" class="slide-content">
                    <div class="slide-header">â‘¤ ãƒ‡ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³</div>
                    <div class="slide-body" id="slide-5-body"></div>
                  </div>
                  <div id="slide-6" class="slide-content">
                    <div class="slide-header">âœ… æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                    <div class="slide-body" id="slide-6-body"></div>
                  </div>
                  <div class="slide-footer">
                    <span>CharmSurvey</span>
                    <span id="slide-number">1 / 6</span>
                  </div>
                </div>
              </div>

              <div class="slide-controls">
                <button class="slide-btn" onclick="previousSlide()">â† å‰ã¸</button>
                <button class="slide-btn" onclick="nextSlide()">æ¬¡ã¸ â†’</button>
              </div>
              <div class="slide-counter" id="slide-counter">ã‚¹ãƒ©ã‚¤ãƒ‰ 1 / 6</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RESPONDENT MODE (SURVEY) -->
  <div id="survey-mode" class="survey-container" style="display: none; max-width: 600px; margin: 50px auto; padding: 40px; background-color: white; border-radius: 8px;">
    <div class="survey-header">
      <div class="survey-title">çµ„ç¹”ã‚µãƒ¼ãƒ™ã‚¤</div>
      <p style="color: #64748B; margin-bottom: 20px;" id="survey-company-name">ä¼šç¤¾å</p>
      <div class="survey-progress">
        <span id="progress-text">Q1 / Q5</span>
        <span>ç´„3åˆ†ã§å®Œäº†</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>

    <form id="survey-form" onsubmit="handleSurveySubmit(event)">
      <!-- å›ç­”è€…æƒ…å ± -->
      <div id="responder-info-section" class="form-section">
        <label class="form-label">ã¾ãšã€ã‚ãªãŸã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„</label>

        <label class="form-sublabel">åå‰</label>
        <input type="text" class="form-input" id="survey-name" required>

        <label class="form-sublabel">å…¥ç¤¾å¹´æœˆæ—¥</label>
        <input type="date" class="form-input" id="survey-joined-date" required>

        <label class="form-sublabel">éƒ¨ç½²</label>
        <select class="form-select" id="survey-department" required>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="å–¶æ¥­">å–¶æ¥­</option>
          <option value="ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</option>
          <option value="CS">CS</option>
          <option value="ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢">ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</option>
          <option value="çµŒå–¶å±¤">çµŒå–¶å±¤</option>
        </select>

        <label class="form-sublabel">å½¹è·</label>
        <input type="text" class="form-input" id="survey-position" placeholder="ä¾‹: å–¶æ¥­éƒ¨é•·">

        <div class="button-group">
          <button type="button" class="btn-primary" onclick="startSurvey()">å›ç­”ã‚’é–‹å§‹ã™ã‚‹</button>
        </div>
      </div>

      <!-- Q1ï½Q5 -->
      <div id="q1-section" class="form-section hidden">
        <label class="form-label">Q1: å½“ç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼äº‹æ¥­ã‚’ä¸€è¨€ã§è¡¨ã™ã¨ï¼Ÿ</label>
        <label class="form-sublabel">å›ç­”ä¾‹ï¼šã€Œå–¶æ¥­æ´»å‹•ã‚’æœ€é©åŒ–ã™ã‚‹SaaSã€</label>
        <textarea class="form-textarea" id="q1-text" placeholder="20ï½30æ–‡å­—ã§"></textarea>
        <div class="rating-group">
          <label class="rating-label">ä¸Šè¨˜ã®å®šç¾©ãŒã©ã®ç¨‹åº¦ã€ã‚ãªãŸã®èªè­˜ã¨åˆè‡´ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</label>
          <div class="rating-options" id="q1-rating">
            <button type="button" class="rating-option" data-value="1">â‘  å…¨ãè¨€ãˆãªã„</button>
            <button type="button" class="rating-option" data-value="2">â‘¡ ã‚ã¾ã‚Šè¨€ãˆãªã„</button>
            <button type="button" class="rating-option" data-value="3">â‘¢ ã‚ã‚‹ç¨‹åº¦è¨€ãˆã‚‹</button>
            <button type="button" class="rating-option" data-value="4">â‘£ ã‹ãªã‚Šè¨€ãˆã‚‹</button>
            <button type="button" class="rating-option" data-value="5">â‘¤ æ˜ç¢ºã«è¨€ãˆã‚‹</button>
          </div>
        </div>
        <div class="button-group">
          <button type="button" class="btn-secondary" onclick="previousQuestion()">æˆ»ã‚‹</button>
          <button type="button" class="btn-primary" onclick="nextQuestion()">æ¬¡ã¸</button>
        </div>
      </div>

      <div id="q2-section" class="form-section hidden">
        <label class="form-label">Q2: å½“ç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã€ä»–ç¤¾ã§ã¯ãªãå½“ç¤¾ãŒé¸ã°ã‚Œã‚‹ç†ç”±ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ</label>
        <textarea class="form-textarea" id="q2-text" placeholder="300æ–‡å­—ä»¥å†…ã§"></textarea>
        <div class="rating-group">
          <label class="rating-label">èª¬æ˜ã®è‡ªä¿¡åº¦</label>
          <div class="rating-options" id="q2-rating">
            <button type="button" class="rating-option" data-value="1">â‘  å…¨ãèª¬æ˜ã§ããªã„</button>
            <button type="button" class="rating-option" data-value="2">â‘¡ ã‚ã¾ã‚Šèª¬æ˜ã§ããªã„</button>
            <button type="button" class="rating-option" data-value="3">â‘¢ ã‚ã‚‹ç¨‹åº¦èª¬æ˜ã§ãã‚‹</button>
            <button type="button" class="rating-option" data-value="4">â‘£ ã‹ãªã‚Šèª¬æ˜ã§ãã‚‹</button>
            <button type="button" class="rating-option" data-value="5">â‘¤ å¼·ãè‡ªä¿¡ã‚’æŒã£ã¦èª¬æ˜ã§ãã‚‹</button>
          </div>
        </div>
        <div class="button-group">
          <button type="button" class="btn-secondary" onclick="previousQuestion()">æˆ»ã‚‹</button>
          <button type="button" class="btn-primary" onclick="nextQuestion()">æ¬¡ã¸</button>
        </div>
      </div>

      <div id="q3-section" class="form-section hidden">
        <label class="form-label">Q3: ç¤¾å†…ã§å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã®é­…åŠ›ã‚’èªã‚‹éš›ã€ä½¿ã‚ã‚Œã¦ã„ã‚‹è¨€è‘‰ã‚„è¡¨ç¾ã¯ã©ã®ç¨‹åº¦å…±é€šã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ</label>
        <label class="form-sublabel">ç†ç”±</label>
        <textarea class="form-textarea" id="q3-text" placeholder="300æ–‡å­—ä»¥å†…ã§"></textarea>
        <div class="rating-group">
          <label class="rating-label">è¨€èªçµ±ä¸€åº¦</label>
          <div class="rating-options" id="q3-rating">
            <button type="button" class="rating-option" data-value="1">â‘  å…¨ãæƒã£ã¦ã„ãªã„</button>
            <button type="button" class="rating-option" data-value="2">â‘¡ ã‚ã¾ã‚Šæƒã£ã¦ã„ãªã„</button>
            <button type="button" class="rating-option" data-value="3">â‘¢ ã‚ã‚‹ç¨‹åº¦æƒã£ã¦ã„ã‚‹</button>
            <button type="button" class="rating-option" data-value="4">â‘£ ã»ã¼åŒã˜è¨€è‘‰ã§èªã‚‰ã‚Œã¦ã„ã‚‹</button>
            <button type="button" class="rating-option" data-value="5">â‘¤ éå¸¸ã«æƒã£ã¦ã„ã‚‹</button>
          </div>
        </div>
        <div class="button-group">
          <button type="button" class="btn-secondary" onclick="previousQuestion()">æˆ»ã‚‹</button>
          <button type="button" class="btn-primary" onclick="nextQuestion()">æ¬¡ã¸</button>
        </div>
      </div>

      <div id="q4-section" class="form-section hidden">
        <label class="form-label">Q4: å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ãŒã€é¡§å®¢ã®æ„æ€æ±ºå®šã‚„è¡Œå‹•ã‚’å¤‰ãˆãŸäº‹ä¾‹ã‚’æ€ã„æµ®ã‹ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹ï¼Ÿ</label>
        <textarea class="form-textarea" id="q4-text" placeholder="å…·ä½“ä¾‹ã‚’300æ–‡å­—ä»¥å†…ã§"></textarea>
        <div class="rating-group">
          <label class="rating-label">äº‹ä¾‹æƒ³èµ·åº¦</label>
          <div class="rating-options" id="q4-rating">
            <button type="button" class="rating-option" data-value="1">â‘  å…¨ãæ€ã„æµ®ã‹ã°ãªã„</button>
            <button type="button" class="rating-option" data-value="2">â‘¡ ã‚ã¾ã‚Šæ€ã„æµ®ã‹ã°ãªã„</button>
            <button type="button" class="rating-option" data-value="3">â‘¢ ã‚ã‚‹ç¨‹åº¦æ€ã„æµ®ã‹ã¶</button>
            <button type="button" class="rating-option" data-value="4">â‘£ è¤‡æ•°æ€ã„æµ®ã‹ã¶</button>
            <button type="button" class="rating-option" data-value="5">â‘¤ å…·ä½“äº‹ä¾‹ã‚’ã‚‚ã¨ã«æ˜ç¢ºã«æ€ã„æµ®ã‹ã¶</button>
          </div>
        </div>
        <div class="button-group">
          <button type="button" class="btn-secondary" onclick="previousQuestion()">æˆ»ã‚‹</button>
          <button type="button" class="btn-primary" onclick="nextQuestion()">æ¬¡ã¸</button>
        </div>
      </div>

      <div id="q5-section" class="form-section hidden">
        <label class="form-label">Q5: å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã®ã€å‘ã„ã¦ã„ãªã„ã‚±ãƒ¼ã‚¹ã€ã‚„ã€å¼±ã¿ãƒ»èª²é¡Œã€ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ</label>
        <textarea class="form-textarea" id="q5-text" placeholder="å…·ä½“çš„ãªåˆ¶ç´„ã‚’300æ–‡å­—ä»¥å†…ã§"></textarea>
        <div class="rating-group">
          <label class="rating-label">åˆ¶ç´„æ˜ç¢ºåº¦</label>
          <div class="rating-options" id="q5-rating">
            <button type="button" class="rating-option" data-value="1">â‘  å…¨ãèª¬æ˜ã§ããªã„</button>
            <button type="button" class="rating-option" data-value="2">â‘¡ ã‚ã¾ã‚Šèª¬æ˜ã§ããªã„</button>
            <button type="button" class="rating-option" data-value="3">â‘¢ å°‘ã—èª¬æ˜ã§ãã‚‹</button>
            <button type="button" class="rating-option" data-value="4">â‘£ ã‚ã‚‹ç¨‹åº¦èª¬æ˜ã§ãã‚‹</button>
            <button type="button" class="rating-option" data-value="5">â‘¤ æ˜ç¢ºã«èª¬æ˜ã§ãã‚‹</button>
          </div>
        </div>
        <div class="button-group">
          <button type="button" class="btn-secondary" onclick="previousQuestion()">æˆ»ã‚‹</button>
          <button type="submit" class="btn-primary">å›ç­”ã‚’é€ä¿¡</button>
        </div>
      </div>
    </form>
  </div>

  <!-- PROMPT MODAL -->
  <div id="prompt-modal" class="modal">
    <div class="modal-content">
      <div class="modal-title">ğŸ“‹ AIåˆ†æç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
      <div class="modal-body" id="prompt-content"></div>
      <div class="modal-buttons">
        <button class="modal-copy-btn" onclick="copyPromptToClipboard()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        <button class="modal-close-btn" onclick="closePromptModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
    // ===== DATA MANAGEMENT =====
    let currentCompanyId = null;
    let currentQuestion = 0;
    let currentSlide = 1;
    let qrCodeInstance = null;
    let baseDomain = ''; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³å

    let companies = {
      'sample-corp': {
        name: 'ã‚µãƒ³ãƒ—ãƒ«æ ªå¼ä¼šç¤¾',
        surveyLink: '?mode=survey&company=sample-corp',
        responders: [
          { id: 1, name: 'å±±ç”°å¤ªéƒ', joined: '2018-04-01', department: 'å–¶æ¥­', position: 'å–¶æ¥­éƒ¨é•·', answers: [
            { q: 1, text: 'å–¶æ¥­æ´»å‹•ã‚’æœ€é©åŒ–ã™ã‚‹SaaS', rating: 5 },
            { q: 2, text: 'æ©Ÿèƒ½ãŒå……å®Ÿã—ã¦ãŠã‚Šã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ã«å„ªã‚Œã¦ã„ã‚‹ã€‚ç«¶åˆä»–ç¤¾ã¨æ¯”ã¹ã¦å°å…¥å®Ÿç¸¾ãŒè±Šå¯Œã§ä¿¡é ¼ã§ãã‚‹ã€‚', rating: 4 },
            { q: 3, text: 'å–¶æ¥­ãƒãƒ¼ãƒ å†…ã§ã¯ã€Œå–¶æ¥­åŠ¹ç‡åŒ–ãƒ„ãƒ¼ãƒ«ã€ã¨ã—ã¦çµ±ä¸€ã—ã¦ã„ã‚‹ã€‚ãŒã€çµŒå–¶å±¤ã§ã¯ã€Œå–¶æ¥­DXã€ã¨å‘¼ã¶ã“ã¨ãŒå¤šã„ã€‚', rating: 3 },
            { q: 4, text: 'Aç¤¾ã§ã¯å°å…¥å‰ã¯å–¶æ¥­æ´»å‹•ã®å¯è¦–åŒ–ãŒã§ãã¦ã„ãªã‹ã£ãŸãŒã€å°å…¥å¾Œã¯å£²ä¸ŠãŒ20%å‘ä¸Šã—ãŸã€‚', rating: 4 },
            { q: 5, text: 'å°è¦æ¨¡ä¼æ¥­ã‚„å®šå‹å–¶æ¥­ã«ã¯ä¸å‘ãã€‚è¤‡é›‘ãªå–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‹ãƒ¼ã‚ºã«ã¯éå‰°æ©Ÿèƒ½ã€‚', rating: 4 }
          ]},
          { id: 2, name: 'éˆ´æœ¨èŠ±å­', joined: '2019-07-15', department: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', position: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼', answers: [
            { q: 1, text: 'B2Bã®å–¶æ¥­æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 4 },
            { q: 2, text: 'AIæ­è¼‰ã§å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•åŒ–ãŒå¯èƒ½ã€‚æ¥­ç•Œåˆ¥ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè±Šå¯Œã§å°å…¥ãŒæ—©ã„ã€‚', rating: 5 },
            { q: 3, text: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒ ã§ã¯ã€Œãƒªãƒ¼ãƒ‰ç²å¾—ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ã¨è¨€ã†ã“ã¨ãŒå¤šã„ã€‚å–¶æ¥­ã¨ã®è¡¨ç¾ãŒç•°ãªã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'Bç¤¾ã¯ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–ã§ç²å¾—ã—ãŸãƒªãƒ¼ãƒ‰ã®è¿½è·¡ãŒã‚·ã‚¹ãƒ†ãƒ ã§è‡ªå‹•åŒ–ã•ã‚Œã€æ¡ˆä»¶åŒ–ç‡ãŒå‘ä¸Šã—ãŸã€‚', rating: 5 },
            { q: 5, text: 'APIçµ±åˆã«æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã€‚ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªãã€å–¶æ¥­å¯„ã‚Šã€‚', rating: 3 }
          ]},
          { id: 3, name: 'ä½è—¤æ¬¡éƒ', joined: '2020-02-10', department: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', position: 'ãƒªãƒ¼ãƒ‰', answers: [
            { q: 1, text: 'CRMã¨å–¶æ¥­åˆ†æã®çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 3 },
            { q: 2, text: 'ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã§æ‹¡å¼µæ€§ãŒé«˜ã„ã€‚APIãŒå……å®Ÿã—ã¦ãŠã‚Šä»–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºãŒå®¹æ˜“ã€‚', rating: 4 },
            { q: 3, text: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒãƒ¼ãƒ å†…ã§ã¯æŠ€è¡“çš„ãªè¦–ç‚¹ã§ã€ŒAPIé€£æºãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ã¨å‘¼ã¶ã“ã¨ãŒå¤šã„ã€‚å–¶æ¥­ã¨ã®ã‚®ãƒ£ãƒƒãƒ—ã‚ã‚Šã€‚', rating: 2 },
            { q: 4, text: 'Cç¤¾ã§ã¯ã‚·ã‚¹ãƒ†ãƒ é–“ã®ãƒ‡ãƒ¼ã‚¿é€£æºã«ã‚ˆã‚Šã€å–¶æ¥­ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸé…å»¶ãŒãªããªã£ãŸã€‚', rating: 3 },
            { q: 5, text: 'å¤§è¦æ¨¡ãªæŠ€è¡“å®Ÿè£…ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹ã€‚ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã¯ãªã„ã€‚', rating: 4 }
          ]},
          { id: 4, name: 'ç”°ä¸­èŠ±ç¾', joined: '2021-01-20', department: 'å–¶æ¥­', position: 'å–¶æ¥­', answers: [
            { q: 1, text: 'é¡§å®¢å–¶æ¥­ã‚’æ”¯æ´ã™ã‚‹ãƒ„ãƒ¼ãƒ«', rating: 3 },
            { q: 2, text: 'ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç®¡ç†ãŒç›´æ„Ÿçš„ã€‚å°å…¥ä¼æ¥­ã®æˆåŠŸäº‹ä¾‹ãŒè±Šå¯Œã€‚', rating: 4 },
            { q: 3, text: 'å–¶æ¥­éƒ¨å†…ã§è¡¨ç¾ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„ã€‚æœ€è¿‘å…¥ç¤¾ã—ãŸäººã¨çµŒé¨“è€…ã§è¨€ã„æ–¹ãŒç•°ãªã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'Dç¤¾ã§ã¯ãƒªãƒ¼ãƒ‰è¿½è·¡ã®ç²¾åº¦ãŒå‘ä¸Šã—ã€å–¶æ¥­æ©Ÿä¼šã®å–ã‚Šã“ã¼ã—ãŒæ¸›ã£ãŸã€‚', rating: 4 },
            { q: 5, text: 'ãƒ‡ãƒ¼ã‚¿å“è³ªã«ä¾å­˜ã—ã¦ãŠã‚Šã€ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ãŒå¤šã„ã¨åŠ¹æœãŒè–„ã„ã€‚', rating: 3 }
          ]},
          { id: 5, name: 'é‡æ‘æ…¶å¤ª', joined: '2021-06-01', department: 'CS', position: 'ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ‰', answers: [
            { q: 1, text: 'é¡§å®¢ã‚µã‚¯ã‚»ã‚¹æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ', rating: 3 },
            { q: 2, text: 'CSãƒãƒ¼ãƒ ãŒé¡§å®¢ã®ãƒ˜ãƒ«ã‚¹ã‚¹ã‚³ã‚¢ç®¡ç†ã«æ´»ç”¨ã§ãã‚‹ã€‚æ›´æ–°ãŒé »ç¹ã§æ”¹å–„ãŒæ—©ã„ã€‚', rating: 4 },
            { q: 3, text: 'CSéƒ¨ã§ã¯ç‹¬è‡ªã®ç”¨èªã‚’ä½¿ç”¨ã€‚å…¨ç¤¾ã§å…±é€šè¨€èªãŒãªã„ã€‚', rating: 1 },
            { q: 4, text: 'Eç¤¾ã§ã¯ãƒãƒ£ãƒ¼ãƒ³ãƒªã‚¹ã‚¯é¡§å®¢ã‚’æ—©æœŸã«ç™ºè¦‹ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚', rating: 5 },
            { q: 5, text: 'å–¶æ¥­å¯„ã‚Šã®è¨­è¨ˆã§ã€CSã®æ¥­å‹™ã«ã¯ã‚„ã‚„ç„¡é§„ãªæ©Ÿèƒ½ãŒã‚ã‚‹ã€‚', rating: 2 }
          ]},
          { id: 6, name: 'åŠ è—¤å¤ªéƒ', joined: '2022-04-10', department: 'çµŒå–¶å±¤', position: 'CEO', answers: [
            { q: 1, text: 'å–¶æ¥­DXãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 5 },
            { q: 2, text: 'ROIã‚’æ˜ç¢ºã«ç¤ºã›ã‚‹ã€‚å¸‚å ´ç«¶äº‰åŠ›ãŒå¼·ã„ã€‚', rating: 5 },
            { q: 3, text: 'çµŒå–¶å±¤ã§ã¯ã€ŒDXãƒ„ãƒ¼ãƒ«ã€ã¨å‘¼ã¶ãŒã€å–¶æ¥­ã§ã¯ã€Œå–¶æ¥­ãƒ„ãƒ¼ãƒ«ã€ã¨å‘¼ã¶ã€‚çµŒå–¶å´ã¨å–¶æ¥­ç¾å ´ã§ã®ã‚ºãƒ¬ãŒã‚ã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'è¤‡æ•°ã®é¡§å®¢ã§å£²ä¸Šå‘ä¸Šã¨ã„ã†æˆæœã‚’å¾—ã¦ã„ã‚‹ã€‚', rating: 5 },
            { q: 5, text: 'å¤§ä¼æ¥­å‘ã‘ã§ã€ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ“ã‚¸ãƒã‚¹ã«ã¯å‘ã‹ãªã„ã€‚', rating: 3 }
          ]},
          { id: 7, name: 'æ¸¡è¾ºç¾å’²', joined: '2022-09-01', department: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', position: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', answers: [
            { q: 1, text: 'ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªå–¶æ¥­ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 4 },
            { q: 2, text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¦‹ã‚„ã™ãã€å–¶æ¥­ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ãŒå„ªã‚Œã¦ã„ã‚‹ã€‚', rating: 4 },
            { q: 3, text: 'ä½¿ç”¨ã™ã‚‹ãŸã³ã«èª¬æ˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã»ã©ã€ãƒãƒ¼ãƒ å†…ã§ã®ç†è§£ãŒæµ…ã„ã€‚', rating: 1 },
            { q: 4, text: 'Fç¤¾ã§ã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–ã®åŠ¹æœæ¸¬å®šãŒã—ã‚„ã™ããªã£ãŸã€‚', rating: 4 },
            { q: 5, text: 'åˆæœŸè¨­å®šã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå……å®Ÿã—ã¦ã„ãªã„ã€‚', rating: 2 }
          ]},
          { id: 8, name: 'éˆ´æœ¨å¥å¤ª', joined: '2023-01-15', department: 'CS', position: 'CS', answers: [
            { q: 1, text: 'å–¶æ¥­ãƒ»ã‚µãƒãƒ¼ãƒˆçµ±åˆã‚·ã‚¹ãƒ†ãƒ ', rating: 3 },
            { q: 2, text: 'ã‚µãƒãƒ¼ãƒˆæ¥­å‹™ã®åŠ¹ç‡åŒ–ãŒæœŸå¾…ã§ãã‚‹ã€‚å®‰å®šã—ã¦ã„ã‚‹ã€‚', rating: 3 },
            { q: 3, text: 'CSéƒ¨ã§ã®ç†è§£ãŒä¸è¶³ã—ã¦ã„ã‚‹ã€‚å–¶æ¥­å‘ã‘ã ã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'Gç¤¾ã§ã¯ã‚µãƒãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆã®å¯¾å¿œæ™‚é–“ãŒçŸ­ç¸®ã•ã‚ŒãŸã€‚', rating: 3 },
            { q: 5, text: 'CSå‘ã‘ã®æ©Ÿèƒ½ãŒå°‘ãªã„ã€‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¿…è¦ã€‚', rating: 3 }
          ]},
          { id: 9, name: 'å°æ¾ç”±ç¾', joined: '2023-04-20', department: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', position: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', answers: [
            { q: 1, text: 'SaaSå‹å–¶æ¥­ç®¡ç†ãƒ„ãƒ¼ãƒ«', rating: 2 },
            { q: 2, text: 'ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå……å®Ÿã—ã¦ã„ã‚‹ã€‚', rating: 4 },
            { q: 3, text: 'æŠ€è¡“ãƒãƒ¼ãƒ ã§ã®ã¿ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€çµ±ä¸€è¨€èªãŒãªã„ã€‚', rating: 2 },
            { q: 4, text: 'Hç¤¾ã§ã¯ã‚·ã‚¹ãƒ†ãƒ é€£æºã®è² æ‹…ãŒè»½æ¸›ã•ã‚ŒãŸã€‚', rating: 4 },
            { q: 5, text: 'UI/UXãŒè¤‡é›‘ã€‚åˆå¿ƒè€…ã«ã¯ä½¿ã„ã«ãã„ã€‚', rating: 2 }
          ]},
          { id: 10, name: 'å‰ç”°å¤ªéƒ', joined: '2023-07-10', department: 'å–¶æ¥­', position: 'å–¶æ¥­', answers: [
            { q: 1, text: 'ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«', rating: 2 },
            { q: 2, text: 'å–¶æ¥­ç¾å ´ã§ã®ä½¿ã„ã‚„ã™ã•ãŒé­…åŠ›ã€‚', rating: 4 },
            { q: 3, text: 'ãƒãƒ¼ãƒ å†…ã§è¡¨ç¾ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„ã€‚', rating: 2 },
            { q: 4, text: 'Iç¤¾ã§ã¯æ¡ˆä»¶äºˆæ¸¬ã®ç²¾åº¦ãŒå‘ä¸Šã—ãŸã€‚', rating: 4 },
            { q: 5, text: 'ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒé™å®šçš„ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆãŒå¿…è¦ã€‚', rating: 2 }
          ]},
          { id: 11, name: 'å±±ä¸‹èŠ±å­', joined: '2023-10-01', department: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', position: 'åˆ†æ', answers: [
            { q: 1, text: 'ãƒªãƒ¼ãƒ‰ç®¡ç†ãƒ»å–¶æ¥­æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 3 },
            { q: 2, text: 'ãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½ãŒå……å®Ÿã—ã¦ã„ã‚‹ã€‚', rating: 4 },
            { q: 3, text: 'åˆ†æè¦–ç‚¹ã¨å–¶æ¥­è¦–ç‚¹ã§è¡¨ç¾ãŒç•°ãªã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'Jç¤¾ã§ã¯ãƒªãƒ¼ãƒ‰ã®è³ªãŒå‘ä¸Šã—ãŸã€‚', rating: 4 },
            { q: 5, text: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ãŒä¿è¨¼ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹ã€‚', rating: 2 }
          ]},
          { id: 12, name: 'ç”°ä¸­å¥ä¸€', joined: '2023-11-15', department: 'CS', position: 'CS', answers: [
            { q: 1, text: 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘CRM', rating: 2 },
            { q: 2, text: 'å¤§è¦æ¨¡ä¼æ¥­å¯¾å¿œã€‚ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãŒé«˜ã„ã€‚', rating: 4 },
            { q: 3, text: 'CSéƒ¨ã§ã®ä½¿ç”¨æ–¹æ³•ãŒä¸æ˜ç¢ºã€‚å–¶æ¥­å‘ã‘ãƒ„ãƒ¼ãƒ«ã ã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚', rating: 1 },
            { q: 4, text: 'Kç¤¾ã§ã¯é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒåŒ–ã«ã‚ˆã‚Šã€ã‚µãƒãƒ¼ãƒˆåŠ¹ç‡ãŒå‘ä¸Šã€‚', rating: 3 },
            { q: 5, text: 'ä¸­å°ä¼æ¥­ã«ã¯éå‰°æ©Ÿèƒ½ã€‚ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€‚', rating: 2 }
          ]},
          { id: 13, name: 'ä½è—¤ç”±ç¾', joined: '2024-01-10', department: 'çµŒå–¶å±¤', position: 'CFO', answers: [
            { q: 1, text: 'ä¼æ¥­å‘ã‘ã‚»ãƒ¼ãƒ«ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', rating: 4 },
            { q: 2, text: 'TCOãŒæ˜ç¢ºã§äºˆæ¸¬å¯èƒ½ã€‚çµŒå–¶åˆ¤æ–­ãŒã—ã‚„ã™ã„ã€‚', rating: 4 },
            { q: 3, text: 'çµŒå–¶å±¤ã§ã¯ã€Œå–¶æ¥­DXã€ã ãŒã€å–¶æ¥­ã§ã¯ã€Œå–¶æ¥­ãƒ„ãƒ¼ãƒ«ã€ã¨ã„ã†è¨€èªã‚ºãƒ¬ãŒã‚ã‚‹ã€‚', rating: 2 },
            { q: 4, text: 'è¤‡æ•°äº‹æ¥­ã§ã®å±•é–‹ã«ã‚ˆã‚Šã€é€£çµå£²ä¸Šã¸ã®è²¢çŒ®ãŒã‚ã‚‹ã€‚', rating: 4 },
            { q: 5, text: 'ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€‚æŠ•è³‡å¯¾åŠ¹æœã®æœŸé–“ãŒé•·ã„ã€‚', rating: 3 }
          ]}
        ]
      }
    };

    const questions = [
      { id: 1, text: 'Q1: å½“ç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼äº‹æ¥­ã‚’ä¸€è¨€ã§è¡¨ã™ã¨ï¼Ÿ', options: ['â‘  å…¨ãè¨€ãˆãªã„', 'â‘¡ ã‚ã¾ã‚Šè¨€ãˆãªã„', 'â‘¢ ã‚ã‚‹ç¨‹åº¦è¨€ãˆã‚‹', 'â‘£ ã‹ãªã‚Šè¨€ãˆã‚‹', 'â‘¤ æ˜ç¢ºã«è¨€ãˆã‚‹'] },
      { id: 2, text: 'Q2: å½“ç¤¾ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã€ä»–ç¤¾ã§ã¯ãªãå½“ç¤¾ãŒé¸ã°ã‚Œã‚‹ç†ç”±ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ', options: ['â‘  å…¨ãèª¬æ˜ã§ããªã„', 'â‘¡ ã‚ã¾ã‚Šèª¬æ˜ã§ããªã„', 'â‘¢ ã‚ã‚‹ç¨‹åº¦èª¬æ˜ã§ãã‚‹', 'â‘£ ã‹ãªã‚Šèª¬æ˜ã§ãã‚‹', 'â‘¤ å¼·ãè‡ªä¿¡ã‚’æŒã£ã¦èª¬æ˜ã§ãã‚‹'] },
      { id: 3, text: 'Q3: ç¤¾å†…ã§å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã®é­…åŠ›ã‚’èªã‚‹éš›ã€ä½¿ã‚ã‚Œã¦ã„ã‚‹è¨€è‘‰ã‚„è¡¨ç¾ã¯ã©ã®ç¨‹åº¦å…±é€šã—ã¦ã„ã‚‹ã¨æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ', options: ['â‘  å…¨ãæƒã£ã¦ã„ãªã„', 'â‘¡ ã‚ã¾ã‚Šæƒã£ã¦ã„ãªã„', 'â‘¢ ã‚ã‚‹ç¨‹åº¦æƒã£ã¦ã„ã‚‹', 'â‘£ ã»ã¼åŒã˜è¨€è‘‰ã§èªã‚‰ã‚Œã¦ã„ã‚‹', 'â‘¤ éå¸¸ã«æƒã£ã¦ã„ã‚‹'] },
      { id: 4, text: 'Q4: å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ãŒã€é¡§å®¢ã®æ„æ€æ±ºå®šã‚„è¡Œå‹•ã‚’å¤‰ãˆãŸäº‹ä¾‹ã‚’æ€ã„æµ®ã‹ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹ï¼Ÿ', options: ['â‘  å…¨ãæ€ã„æµ®ã‹ã°ãªã„', 'â‘¡ ã‚ã¾ã‚Šæ€ã„æµ®ã‹ã°ãªã„', 'â‘¢ ã‚ã‚‹ç¨‹åº¦æ€ã„æµ®ã‹ã¶', 'â‘£ è¤‡æ•°æ€ã„æµ®ã‹ã¶', 'â‘¤ å…·ä½“äº‹ä¾‹ã‚’ã‚‚ã¨ã«æ˜ç¢ºã«æ€ã„æµ®ã‹ã¶'] },
      { id: 5, text: 'Q5: å½“ç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã®ã€å‘ã„ã¦ã„ãªã„ã‚±ãƒ¼ã‚¹ã€ã‚„ã€å¼±ã¿ãƒ»èª²é¡Œã€ã‚’èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ', options: ['â‘  å…¨ãèª¬æ˜ã§ããªã„', 'â‘¡ ã‚ã¾ã‚Šèª¬æ˜ã§ããªã„', 'â‘¢ å°‘ã—èª¬æ˜ã§ãã‚‹', 'â‘£ ã‚ã‚‹ç¨‹åº¦èª¬æ˜ã§ãã‚‹', 'â‘¤ æ˜ç¢ºã«èª¬æ˜ã§ãã‚‹'] }
    ];

    // ===== INITIALIZATION =====
    function initializeApp() {
      const mode = getUrlParameter('mode');
      const company = getUrlParameter('company');

      if (mode === 'survey' && company) {
        document.getElementById('admin-mode').style.display = 'none';
        document.getElementById('survey-mode').style.display = 'block';
        const companyName = companies[company]?.name || 'ä¼æ¥­';
        document.getElementById('survey-company-name').textContent = companyName;
      } else {
        document.getElementById('admin-mode').style.display = 'flex';
        document.getElementById('survey-mode').style.display = 'none';
        currentCompanyId = 'sample-corp';
        renderCompanyList();
        renderDashboard();
      }
    }

    function getUrlParameter(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    // ===== ADMIN MODE FUNCTIONS =====
    function renderCompanyList() {
      const list = document.getElementById('company-list');
      list.innerHTML = '';
      Object.keys(companies).forEach(companyId => {
        const company = companies[companyId];
        const div = document.createElement('div');
        div.className = 'company-item' + (companyId === currentCompanyId ? ' active' : '');
        div.textContent = company.name;
        div.onclick = () => switchCompany(companyId);
        list.appendChild(div);
      });
    }

    function switchCompany(companyId) {
      currentCompanyId = companyId;
      renderCompanyList();
      renderDashboard();
    }

    function toggleAddCompanyForm() {
      const form = document.getElementById('add-company-form');
      form.classList.toggle('visible');
      if (form.classList.contains('visible')) {
        document.getElementById('company-name-input').focus();
      }
    }

    function confirmAddCompany() {
      const name = document.getElementById('company-name-input').value.trim();
      if (name) {
        const id = 'company-' + Date.now();
        companies[id] = {
          name: name,
          surveyLink: `?mode=survey&company=${id}`,
          responders: []
        };
        document.getElementById('company-name-input').value = '';
        document.getElementById('add-company-form').classList.remove('visible');
        switchCompany(id);
      } else {
        alert('ä¼æ¥­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
    }

    function cancelAddCompany() {
      document.getElementById('company-name-input').value = '';
      document.getElementById('add-company-form').classList.remove('visible');
    }

    function saveDomainSetting() {
      const domainInput = document.getElementById('domain-input').value.trim();
      if (!domainInput) {
        alert('ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šhttps://charm-survey.example.comï¼‰');
        return;
      }

      // https:// ã¾ãŸã¯ http:// ã§å§‹ã¾ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      if (!domainInput.startsWith('https://') && !domainInput.startsWith('http://')) {
        alert('ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ã€Œhttps://ã€ã¾ãŸã¯ã€Œhttp://ã€ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
        return;
      }

      // æœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
      baseDomain = domainInput.endsWith('/') ? domainInput.slice(0, -1) : domainInput;

      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
      const statusDiv = document.getElementById('domain-status');
      statusDiv.textContent = `âœ“ è¨­å®šå®Œäº†ï¼š${baseDomain}`;
      statusDiv.style.display = 'block';

      // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      if (currentCompanyId) {
        renderResponderSection();
      }
    }

    function renderDashboard() {
      const company = companies[currentCompanyId];
      if (!company) return;

      document.getElementById('current-company-name').textContent = company.name;
      document.getElementById('dashboard-subtitle').textContent = `${company.name} - ${company.responders.length}åã®å›ç­”è€…`;

      renderResponderSection();
      renderQuestions();
      renderReport();
    }

    function renderResponderSection() {
      const company = companies[currentCompanyId];
      const link = document.getElementById('survey-link');
      const tbody = document.getElementById('responder-tbody');

      // ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ + ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      // è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€ã¨è¡¨ç¤º
      if (baseDomain) {
        link.value = baseDomain + company.surveyLink;
        generateQRCode(baseDomain + company.surveyLink);
      } else {
        link.value = 'ã€Œè¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã—ã¦ãã ã•ã„';
        document.getElementById('qr-code').innerHTML = '<p style="color: #999; font-size: 12px; padding: 10px;">ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šå¾Œã«QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>';
      }

      tbody.innerHTML = '';
      company.responders.forEach((responder, index) => {
        const headerRow = document.createElement('tr');
        headerRow.innerHTML = `
          <td class="responder-name-cell" onclick="toggleResponderDetails(${index})">${responder.name}</td>
          <td>${responder.department}</td>
          <td>${responder.position}</td>
          <td>${responder.joined}</td>
          <td><span style="color: #10B981; font-weight: bold;">å›ç­”æ¸ˆã¿</span></td>
        `;
        tbody.appendChild(headerRow);

        const detailsRow = document.createElement('tr');
        detailsRow.className = 'responder-details-row';
        detailsRow.id = `responder-details-${index}`;
        detailsRow.innerHTML = `
          <td colspan="5">
            <div class="responder-details-content">
              ${renderResponderAnswers(responder)}
            </div>
          </td>
        `;
        tbody.appendChild(detailsRow);
      });
    }

    function generateQRCode(url) {
      const qrContainer = document.getElementById('qr-code');
      qrContainer.innerHTML = ''; // Clear previous QR code

      if (qrCodeInstance) {
        qrCodeInstance = null;
      }

      qrCodeInstance = new QRCode(qrContainer, {
        text: url,
        width: 150,
        height: 150,
        colorDark: '#1F4788',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    function toggleResponderDetails(index) {
      const detailsRow = document.getElementById(`responder-details-${index}`);
      detailsRow.classList.toggle('expanded');
    }

    function renderResponderAnswers(responder) {
      let html = '';
      responder.answers.forEach(answer => {
        const question = questions[answer.q - 1];
        html += `
          <div class="answer-section">
            <div class="question-label">Q${answer.q}</div>
            <div class="question-text">${question.text}</div>
            <div class="answer-text">"${answer.text}"</div>
            <div class="answer-rating">è©•ä¾¡: ${answer.rating}/5</div>
          </div>
        `;
      });
      return html;
    }

    function copySurveyLink() {
      const link = document.getElementById('survey-link').value;
      navigator.clipboard.writeText(link).then(() => {
        const btn = event.target;
        btn.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'ã‚³ãƒ”ãƒ¼';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    function openSurveyPreview() {
      const link = document.getElementById('survey-link').value;
      window.open(link, '_blank');
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');

      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      if (tabName === 'report-tab') {
        currentSlide = 1;
        renderReport();
      }
    }

    function renderQuestions() {
      const tbody = document.querySelector('#questions-tbody');
      tbody.innerHTML = '';

      questions.forEach(question => {
        const tr = document.createElement('tr');
        tr.id = `question-${question.id}`;
        tr.innerHTML = `
          <td class="question-text-cell">${question.text}</td>
          <td>
            <button class="edit-button" onclick="editQuestion(${question.id})">ç·¨é›†</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function editQuestion(questionId) {
      const question = questions[questionId - 1];
      const tr = document.getElementById(`question-${questionId}`);

      const isEditing = tr.classList.contains('edit-mode');

      if (!isEditing) {
        tr.classList.add('edit-mode');

        let optionsHtml = '<table class="options-table"><thead><tr><th>ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</th><th>é¸æŠè‚¢ãƒ†ã‚­ã‚¹ãƒˆ</th></tr></thead><tbody>';
        question.options.forEach((option, idx) => {
          optionsHtml += `
            <tr>
              <td>${option.split(' ')[0]}</td>
              <td><input type="text" id="option-${idx}" value="${option.substring(option.indexOf(' ')+1)}" /></td>
            </tr>
          `;
        });
        optionsHtml += '</tbody></table>';

        tr.innerHTML = `
          <td colspan="2">
            <div style="padding: 10px;">
              <label style="display: block; font-weight: bold; margin-bottom: 10px;">è³ªå•æ–‡ã‚’ç·¨é›†</label>
              <textarea class="question-text-input" id="edit-question-input">${question.text}</textarea>
              <label style="display: block; font-weight: bold; margin-bottom: 10px;">é¸æŠè‚¢ã‚’ç·¨é›†</label>
              ${optionsHtml}
              <div class="edit-controls">
                <button class="btn-save" onclick="saveQuestion(${questionId})">ä¿å­˜</button>
                <button class="btn-cancel" onclick="cancelEditQuestion()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              </div>
            </div>
          </td>
        `;
        setTimeout(() => {
          document.getElementById('edit-question-input').focus();
        }, 100);
      }
    }

    function saveQuestion(questionId) {
      const newText = document.getElementById('edit-question-input').value;
      if (newText.trim()) {
        questions[questionId - 1].text = newText;

        // Save options
        const question = questions[questionId - 1];
        question.options.forEach((_, idx) => {
          const optionInput = document.getElementById(`option-${idx}`);
          if (optionInput) {
            const ratingLabel = question.options[idx].split(' ')[0];
            question.options[idx] = ratingLabel + ' ' + optionInput.value;
          }
        });

        renderQuestions();
        alert('è³ªå•ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      }
    }

    function cancelEditQuestion() {
      renderQuestions();
    }

    // ===== SLIDE FUNCTIONS =====
    function renderReport() {
      const company = companies[currentCompanyId];
      const customText = document.getElementById('report-custom-text').value;
      const avgRating = calculateAverageRating().toFixed(1);

      // Slide 1: Summary
      document.getElementById('slide-1-body').innerHTML = `
        <p style="margin-bottom: 15px;">
          <strong>å¹³å‡è©•ä¾¡:</strong> ${avgRating}/5<br>
          <strong>å›ç­”è€…æ•°:</strong> ${company.responders.length}å<br>
          <strong>éƒ¨ç½²æ•°:</strong> ${getUniqueDepartments().length}
        </p>
        <p style="margin-top: 15px; font-style: italic;">
          ${customText || 'ï¼ˆã“ã“ã«è¿½è¨˜å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰'}
        </p>
      `;

      // Slide 2: Question Analysis
      let slide2Html = '<table style="width: 100%; margin-top: 10px;"><tbody>';
      for (let q = 1; q <= 5; q++) {
        const ratings = company.responders.flatMap(r => r.answers.filter(a => a.q === q).map(a => a.rating));
        const avgQ = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : 0;
        slide2Html += `<tr><td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.2);">Q${q}: ${avgQ}/5</td></tr>`;
      }
      slide2Html += '</tbody></table>';
      document.getElementById('slide-2-body').innerHTML = slide2Html;

      // Slide 3: Department Analysis
      const departments = getUniqueDepartments();
      let slide3Html = '<table style="width: 100%; margin-top: 10px;"><tbody>';
      departments.forEach(dept => {
        const deptResponders = company.responders.filter(r => r.department === dept);
        const ratings = deptResponders.flatMap(r => r.answers.map(a => a.rating));
        const avgDept = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : 0;
        slide3Html += `<tr><td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.2);">${dept} (${deptResponders.length}å): ${avgDept}/5</td></tr>`;
      });
      slide3Html += '</tbody></table>';
      document.getElementById('slide-3-body').innerHTML = slide3Html;

      // Slide 4: AI Analysis
      const q3Ratings = company.responders.flatMap(r => r.answers.filter(a => a.q === 3).map(a => a.rating));
      const q3Avg = q3Ratings.length > 0 ? (q3Ratings.reduce((a, b) => a + b, 0) / q3Ratings.length).toFixed(1) : 0;
      let slide4Html = '';
      if (q3Avg < 2.5) {
        slide4Html = 'ğŸ”´ <strong>è¨€èªçµ±ä¸€åº¦ãŒéå¸¸ã«ä½ã„</strong><br>çµ„ç¹”å†…ã§äº‹æ¥­å®šç¾©ãŒå¤§ããç•°ãªã£ã¦ã„ã¾ã™ã€‚';
      } else if (q3Avg < 3.5) {
        slide4Html = 'ğŸŸ¡ <strong>è¨€èªçµ±ä¸€åº¦ãŒä½ã„</strong><br>éƒ¨ç½²ã«ã‚ˆã£ã¦äº‹æ¥­ã®èª¬æ˜æ–¹æ³•ã«ã°ã‚‰ã¤ããŒã‚ã‚Šã¾ã™ã€‚';
      } else {
        slide4Html = 'ğŸŸ¢ <strong>è¨€èªçµ±ä¸€åº¦ãŒé«˜ã„</strong><br>çµ„ç¹”å†…ã§ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ãŒæ¯”è¼ƒçš„çµ±ä¸€ã•ã‚Œã¦ã„ã¾ã™ã€‚';
      }
      document.getElementById('slide-4-body').innerHTML = slide4Html;

      // Slide 5: Chart placeholder
      document.getElementById('slide-5-body').innerHTML = '<p style="text-align: center; padding: 40px 0;">ğŸ“Š ã‚°ãƒ©ãƒ•ã¯PDF/ã‚¹ãƒ©ã‚¤ãƒ‰å‡ºåŠ›æ™‚ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>';

      // Slide 6: Recommendations
      const slide6Html = `
        <ol style="margin-left: 20px; line-height: 2;">
          <li>äº‹æ¥­å®šç¾©ã®å†å…±æœ‰</li>
          <li>å–¶æ¥­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®çµ±ä¸€</li>
          <li>éƒ¨ç½²åˆ¥ç ”ä¿®ã®å®Ÿæ–½</li>
        </ol>
      `;
      document.getElementById('slide-6-body').innerHTML = slide6Html;

      updateSlideIndicator();
    }

    function nextSlide() {
      if (currentSlide < 6) {
        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide++;
        document.getElementById(`slide-${currentSlide}`).classList.add('active');
        updateSlideIndicator();
      }
    }

    function previousSlide() {
      if (currentSlide > 1) {
        document.getElementById(`slide-${currentSlide}`).classList.remove('active');
        currentSlide--;
        document.getElementById(`slide-${currentSlide}`).classList.add('active');
        updateSlideIndicator();
      }
    }

    function updateSlideIndicator() {
      document.getElementById('slide-number').textContent = `${currentSlide} / 6`;
      document.getElementById('slide-counter').textContent = `ã‚¹ãƒ©ã‚¤ãƒ‰ ${currentSlide} / 6`;
    }

    // ===== UTILITY FUNCTIONS =====
    function calculateAverageRating() {
      const company = companies[currentCompanyId];
      let total = 0, count = 0;
      company.responders.forEach(responder => {
        responder.answers.forEach(answer => {
          total += answer.rating;
          count++;
        });
      });
      return count > 0 ? total / count : 0;
    }

    function getUniqueDepartments() {
      const company = companies[currentCompanyId];
      return [...new Set(company.responders.map(r => r.department))];
    }

    function generatePDF() {
      const customText = document.getElementById('report-custom-text').value;
      if (customText) {
        renderReport();
      }
      alert('PDFç”Ÿæˆæ©Ÿèƒ½ã¯ã‚¹ãƒ†ãƒƒãƒ—2ã§å®Ÿè£…ã„ãŸã—ã¾ã™ã€‚\n\nãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œå°åˆ·ã€â†’ã€ŒPDFã§ä¿å­˜ã€ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚\n\nã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: Ctrl+Pï¼ˆWindowsï¼‰/ Cmd+Pï¼ˆMacï¼‰');
    }

    function generateGoogleSlides() {
      const companyName = companies[currentCompanyId].name;
      alert('Google Slidesè‡ªå‹•ç”Ÿæˆã«ã¤ã„ã¦\n\nä»¥ä¸‹ã®æ‰‹é †ã§é€²ã‚ã¦ãã ã•ã„ï¼š\n\n1. æ–°ã—ã„ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ\n2. ä¸Šè¨˜ã®ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‚’ã‚¹ãƒ©ã‚¤ãƒ‰ã«è²¼ã‚Šä»˜ã‘\n3. ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º\n\nã‚¹ãƒ†ãƒƒãƒ—2ã§å®Œå…¨ãªè‡ªå‹•åŒ–ã‚’å®Ÿè£…ã„ãŸã—ã¾ã™ã€‚');
    }

    function showPrompt() {
      const company = companies[currentCompanyId];
      const avgRating = calculateAverageRating().toFixed(1);
      const respondentCount = company.responders.length;

      const prompt = `ä»¥ä¸‹ã®çµ„ç¹”ã‚µãƒ¼ãƒ™ã‚¤çµæœã‚’åˆ†æã—ã€CEOå‘ã‘ã®ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ä¼æ¥­å: ${company.name}
å›ç­”è€…æ•°: ${respondentCount}å
å¹³å‡è©•ä¾¡: ${avgRating}/5

## å‡ºåŠ›å½¢å¼
- ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼ˆ2-3æ®µè½ï¼‰
- ä¸»è¦ãªæ°—ã¥ãï¼ˆ3é …ç›®ï¼‰
- æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ3é …ç›®ï¼‰`;

      const modal = document.getElementById('prompt-modal');
      const content = document.getElementById('prompt-content');
      content.textContent = prompt;
      modal.classList.add('visible');
    }

    function closePromptModal() {
      document.getElementById('prompt-modal').classList.remove('visible');
    }

    function copyPromptToClipboard() {
      const content = document.getElementById('prompt-content').textContent;
      navigator.clipboard.writeText(content).then(() => {
        alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
      });
    }

    // ===== SURVEY MODE =====
    function startSurvey() {
      const name = document.getElementById('survey-name').value;
      const dept = document.getElementById('survey-department').value;
      if (!name || !dept) {
        alert('åå‰ã¨éƒ¨ç½²ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      document.getElementById('responder-info-section').classList.add('hidden');
      document.getElementById('q1-section').classList.remove('hidden');
      currentQuestion = 1;
      updateSurveyProgress();
      setupRatingListeners();
    }

    function nextQuestion() {
      if (currentQuestion < 5) {
        document.getElementById(`q${currentQuestion}-section`).classList.add('hidden');
        currentQuestion++;
        document.getElementById(`q${currentQuestion}-section`).classList.remove('hidden');
        updateSurveyProgress();
        setupRatingListeners();
      }
    }

    function previousQuestion() {
      if (currentQuestion > 1) {
        document.getElementById(`q${currentQuestion}-section`).classList.add('hidden');
        currentQuestion--;
        if (currentQuestion === 0) {
          document.getElementById('responder-info-section').classList.remove('hidden');
        } else {
          document.getElementById(`q${currentQuestion}-section`).classList.remove('hidden');
        }
        updateSurveyProgress();
      }
    }

    function updateSurveyProgress() {
      const progress = (currentQuestion / 5) * 100;
      document.getElementById('progress-bar').style.width = progress + '%';
      document.getElementById('progress-text').textContent = `Q${currentQuestion} / 5`;
    }

    function setupRatingListeners() {
      const q = currentQuestion;
      const ratingOptions = document.querySelectorAll(`#q${q}-rating .rating-option`);
      ratingOptions.forEach(option => {
        option.addEventListener('click', function(e) {
          e.preventDefault();
          ratingOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
    }

    function handleSurveySubmit(event) {
      event.preventDefault();
      alert('ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼');
      window.close();
    }

    // Initialize
    initializeApp();
  </script>
</body>
</html>
